<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PPTX è½¬æ¢æœåŠ¡æµ‹è¯•é¡µé¢</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            padding: 40px;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .upload-section {
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            margin-bottom: 20px;
            transition: all 0.3s;
        }

        .upload-section:hover {
            border-color: #667eea;
            background: #f0f2ff;
        }

        .upload-section.dragover {
            border-color: #667eea;
            background: #e8ecff;
            transform: scale(1.02);
        }

        .icon {
            font-size: 48px;
            margin-bottom: 15px;
            color: #667eea;
        }

        .file-input {
            display: none;
        }

        .upload-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 15px;
        }

        .upload-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .upload-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .file-info {
            margin-top: 20px;
            padding: 15px;
            background: white;
            border-radius: 6px;
            display: none;
        }

        .file-info.show {
            display: block;
        }

        .file-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .file-size {
            color: #666;
            font-size: 14px;
        }

        .options {
            margin: 20px 0;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .option {
            flex: 1;
            min-width: 200px;
        }

        .option label {
            display: flex;
            align-items: center;
            cursor: pointer;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
            transition: all 0.3s;
        }

        .option label:hover {
            background: #e9ecef;
        }

        .option input[type="checkbox"] {
            margin-right: 10px;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .progress-section {
            margin-top: 20px;
            display: none;
        }

        .progress-section.show {
            display: block;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e9ecef;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 14px;
        }

        .status {
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
            display: none;
        }

        .status.show {
            display: block;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .result-section {
            margin-top: 20px;
            display: none;
        }

        .result-section.show {
            display: block;
        }

        .result-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
        }

        .result-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }

        .result-value {
            color: #666;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            word-break: break-all;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            margin-right: 10px;
            margin-top: 10px;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .api-info {
            margin-top: 30px;
            padding: 20px;
            background: #fff3cd;
            border-radius: 6px;
            border: 1px solid #ffeeba;
        }

        .api-info h3 {
            color: #856404;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .api-info code {
            background: #f8f9fa;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“Š PPTX è½¬æ¢æœåŠ¡</h1>
        <p class="subtitle">å°† PowerPoint PPTX æ–‡ä»¶è½¬æ¢ä¸º PPTist JSON æ ¼å¼</p>

        <div class="upload-section" id="uploadSection">
            <div class="icon">ğŸ“</div>
            <h3>æ‹–æ”¾æ–‡ä»¶åˆ°è¿™é‡Œ</h3>
            <p style="color: #666; margin: 10px 0;">æˆ–è€…</p>
            <button class="upload-btn" onclick="document.getElementById('fileInput').click()">
                é€‰æ‹© PPTX æ–‡ä»¶
            </button>
            <input type="file" id="fileInput" class="file-input" accept=".pptx" onchange="handleFileSelect(event)">
            <p style="color: #999; font-size: 13px; margin-top: 15px;">æœ€å¤§æ–‡ä»¶å¤§å°: 100MB</p>
        </div>

        <div class="file-info" id="fileInfo">
            <div class="file-name" id="fileName"></div>
            <div class="file-size" id="fileSize"></div>
        </div>

        <div class="options">
            <div class="option">
                <label>
                    <input type="checkbox" id="extractMedia" checked>
                    æå–åª’ä½“æ–‡ä»¶
                </label>
            </div>
            <div class="option">
                <label>
                    <input type="checkbox" id="includeAnimations" checked>
                    åŒ…å«åŠ¨ç”»æ•ˆæœ
                </label>
            </div>
            <div class="option">
                <label>
                    <input type="checkbox" id="includeNotes" checked>
                    åŒ…å«æ¼”è®²è€…å¤‡æ³¨
                </label>
            </div>
        </div>

        <button class="upload-btn" id="uploadBtn" onclick="uploadFile()" disabled style="width: 100%; margin-top: 0;">
            å¼€å§‹è½¬æ¢
        </button>

        <div class="progress-section" id="progressSection">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill">0%</div>
            </div>
            <div class="status info" id="progressStatus">
                æ­£åœ¨ä¸Šä¼ æ–‡ä»¶...
            </div>
        </div>

        <div class="status" id="statusMessage"></div>

        <div class="result-section" id="resultSection">
            <div class="result-card">
                <div class="result-title">ä»»åŠ¡ ID</div>
                <div class="result-value" id="taskId"></div>
            </div>
            <div class="result-card">
                <div class="result-title">ä»»åŠ¡çŠ¶æ€</div>
                <div class="result-value" id="taskStatus"></div>
            </div>
            <div>
                <button class="btn btn-primary" onclick="checkStatus()">åˆ·æ–°çŠ¶æ€</button>
                <button class="btn btn-secondary" onclick="downloadResult()">ä¸‹è½½ç»“æœ</button>
                <button class="btn btn-secondary" onclick="reset()">é‡æ–°ä¸Šä¼ </button>
            </div>
        </div>

        <div class="api-info">
            <h3>ğŸ“– API æ–‡æ¡£</h3>
            <p style="color: #856404; font-size: 14px; margin-bottom: 10px;">
                å®Œæ•´çš„ API æ–‡æ¡£å¯è®¿é—®: <a href="http://localhost:3000/docs" target="_blank" style="color: #667eea;">http://localhost:3000/docs</a>
            </p>
            <p style="color: #856404; font-size: 14px;">
                å¥åº·æ£€æŸ¥: <code>GET /health</code><br>
                æ–‡ä»¶è½¬æ¢: <code>POST /api/v1/convert</code><br>
                æŸ¥è¯¢çŠ¶æ€: <code>GET /api/v1/tasks/:id</code><br>
                è·å–ç»“æœ: <code>GET /api/v1/tasks/:id/result</code>
            </p>
        </div>
    </div>

    <script>
        let selectedFile = null;
        let currentTaskId = null;

        const uploadSection = document.getElementById('uploadSection');
        const fileInfo = document.getElementById('fileInfo');
        const fileName = document.getElementById('fileName');
        const fileSize = document.getElementById('fileSize');
        const uploadBtn = document.getElementById('uploadBtn');
        const progressSection = document.getElementById('progressSection');
        const progressFill = document.getElementById('progressFill');
        const progressStatus = document.getElementById('progressStatus');
        const statusMessage = document.getElementById('statusMessage');
        const resultSection = document.getElementById('resultSection');

        // Drag and drop handlers
        uploadSection.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadSection.classList.add('dragover');
        });

        uploadSection.addEventListener('dragleave', () => {
            uploadSection.classList.remove('dragover');
        });

        uploadSection.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadSection.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                handleFile(file);
            }
        }

        function handleFile(file) {
            // Validate file type
            if (!file.name.endsWith('.pptx')) {
                showStatus('error', 'è¯·é€‰æ‹© .pptx æ ¼å¼çš„æ–‡ä»¶');
                return;
            }

            // Validate file size (100MB)
            const maxSize = 100 * 1024 * 1024;
            if (file.size > maxSize) {
                showStatus('error', 'æ–‡ä»¶å¤§å°è¶…è¿‡ 100MB é™åˆ¶');
                return;
            }

            selectedFile = file;
            fileName.textContent = file.name;
            fileSize.textContent = formatFileSize(file.size);
            fileInfo.classList.add('show');
            uploadBtn.disabled = false;
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
        }

        async function uploadFile() {
            if (!selectedFile) {
                showStatus('error', 'è¯·å…ˆé€‰æ‹©æ–‡ä»¶');
                return;
            }

            const formData = new FormData();
            formData.append('file', selectedFile);
            formData.append('extractMedia', document.getElementById('extractMedia').checked);
            formData.append('includeAnimations', document.getElementById('includeAnimations').checked);
            formData.append('includeNotes', document.getElementById('includeNotes').checked);

            // Show progress
            progressSection.classList.add('show');
            progressFill.style.width = '0%';
            progressFill.textContent = '0%';
            progressStatus.classList.add('show');
            statusMessage.classList.remove('show');

            uploadBtn.disabled = true;

            try {
                // Upload file
                progressStatus.textContent = 'æ­£åœ¨ä¸Šä¼ æ–‡ä»¶...';
                progressFill.style.width = '50%';
                progressFill.textContent = '50%';

                const response = await fetch('/api/v1/convert/', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    currentTaskId = data.taskId;
                    progressFill.style.width = '100%';
                    progressFill.textContent = '100%';
                    progressStatus.textContent = 'æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼Œæ­£åœ¨è½¬æ¢...';

                    // Show task ID
                    document.getElementById('taskId').textContent = data.taskId;
                    resultSection.classList.add('show');

                    // Start checking status
                    setTimeout(() => checkStatus(), 2000);
                } else {
                    showStatus('error', data.error || 'ä¸Šä¼ å¤±è´¥');
                    progressSection.classList.remove('show');
                    uploadBtn.disabled = false;
                }
            } catch (error) {
                showStatus('error', 'ç½‘ç»œé”™è¯¯: ' + error.message);
                progressSection.classList.remove('show');
                uploadBtn.disabled = false;
            }
        }

        async function checkStatus() {
            if (!currentTaskId) return;

            try {
                const response = await fetch(`/api/v1/tasks/${currentTaskId}`);
                const data = await response.json();

                if (data.success) {
                    const status = data.status;
                    document.getElementById('taskStatus').textContent = status.toUpperCase();
                    progressStatus.textContent = `ä»»åŠ¡çŠ¶æ€: ${getStatusText(status)}`;

                    if (status === 'completed') {
                        progressSection.classList.remove('show');
                        showStatus('success', 'è½¬æ¢å®Œæˆï¼');
                    } else if (status === 'failed') {
                        progressSection.classList.remove('show');
                        showStatus('error', data.error || 'è½¬æ¢å¤±è´¥');
                    } else {
                        // Continue checking
                        setTimeout(() => checkStatus(), 2000);
                    }
                } else {
                    showStatus('error', data.error || 'æŸ¥è¯¢å¤±è´¥');
                }
            } catch (error) {
                showStatus('error', 'æŸ¥è¯¢çŠ¶æ€å¤±è´¥: ' + error.message);
            }
        }

        function getStatusText(status) {
            const statusMap = {
                'queued': 'é˜Ÿåˆ—ä¸­',
                'processing': 'å¤„ç†ä¸­',
                'completed': 'å·²å®Œæˆ',
                'failed': 'å¤±è´¥'
            };
            return statusMap[status] || status;
        }

        async function downloadResult() {
            if (!currentTaskId) return;

            try {
                window.open(`/api/v1/tasks/${currentTaskId}/result`, '_blank');
            } catch (error) {
                showStatus('error', 'ä¸‹è½½å¤±è´¥: ' + error.message);
            }
        }

        function showStatus(type, message) {
            statusMessage.className = `status ${type} show`;
            statusMessage.textContent = message;
        }

        function reset() {
            selectedFile = null;
            currentTaskId = null;
            document.getElementById('fileInput').value = '';
            fileInfo.classList.remove('show');
            resultSection.classList.remove('show');
            progressSection.classList.remove('show');
            statusMessage.classList.remove('show');
            uploadBtn.disabled = true;
        }
    </script>
</body>
</html>
